/*! Laura Doktorova github.com/olado/doT v1.0.1 */
(function(){function o(){var a={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},b=/&(?!#?\w+;)|<|>|"|'|\//g;return function(){return this?this.replace(b,function(c){return a[c]||c}):this}}function p(a,b,c){return(typeof b==="string"?b:b.toString()).replace(a.define||i,function(l,e,f,g){if(e.indexOf("def.")===0)e=e.substring(4);if(!(e in c))if(f===":"){a.defineParams&&g.replace(a.defineParams,function(n,h,d){c[e]={arg:h,text:d}});e in c||(c[e]=g)}else(new Function("def","def['"+e+"']="+g))(c);return""}).replace(a.use||i,function(l,e){if(a.useParams)e=e.replace(a.useParams,function(g,n,h,d){if(c[h]&&c[h].arg&&d){g=(h+":"+d).replace(/'|\\/g,"_");c.__exp=c.__exp||{};c.__exp[g]=c[h].text.replace(RegExp("(^|[^\\w$])"+c[h].arg+"([^\\w$])","g"),"$1"+d+"$2");return n+"def.__exp['"+g+"']"}});var f=(new Function("def","return "+e))(c);return f?p(a,f,c):f})}function m(a){return a.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ")}var j={version:"1.0.1",templateSettings:{evaluate:/\{\{([\s\S]+?(\}?)+)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,useParams:/(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,defineParams:/^\s*([\w$]+):([\s\S]+)/,conditional:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,varname:"it",strip:true,append:true,selfcontained:false},template:undefined,compile:undefined},q;if(typeof module!=="undefined"&&module.exports)module.exports=j;else if(typeof define==="function"&&define.amd)define(function(){return j});else{q=function(){return this||(0,eval)("this")}();q.doT=j}String.prototype.encodeHTML=o();var r={append:{start:"'+(",end:")+'",endencode:"||'').toString().encodeHTML()+'"},split:{start:"';out+=(",end:");out+='",endencode:"||'').toString().encodeHTML();out+='"}},i=/$^/;j.template=function(a,b,c){b=b||j.templateSettings;var l=b.append?r.append:r.split,e,f=0,g;a=b.use||b.define?p(b,a,c||{}):a;a=("var out='"+(b.strip?a.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):a).replace(/'|\\/g,"\\$&").replace(b.interpolate||i,function(h,d){return l.start+m(d)+l.end}).replace(b.encode||i,function(h,d){e=true;return l.start+m(d)+l.endencode}).replace(b.conditional||i,function(h,d,k){return d?k?"';}else if("+m(k)+"){out+='":"';}else{out+='":k?"';if("+m(k)+"){out+='":"';}out+='"}).replace(b.iterate||i,function(h,d,k,s){if(!d)return"';} } out+='";f+=1;g=s||"i"+f;d=m(d);return"';var arr"+f+"="+d+";if(arr"+f+"){var "+k+","+g+"=-1,l"+f+"=arr"+f+".length-1;while("+g+"<l"+f+"){"+k+"=arr"+f+"["+g+"+=1];out+='"}).replace(b.evaluate||i,function(h,d){return"';"+m(d)+"out+='"})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/(\s|;|\}|^|\{)out\+='';/g,"$1").replace(/\+''/g,"").replace(/(\s|;|\}|^|\{)out\+=''\+/g,"$1out+=");if(e&&b.selfcontained)a="String.prototype.encodeHTML=("+o.toString()+"());"+a;try{return new Function(b.varname,a)}catch(n){typeof console!=="undefined"&&console.log("Could not create a template function: "+a);throw n;}};j.compile=function(a,b){return j.template(a,null,b)}})();
/*! Ryan Grove github.com/rgrove/lazyload */
LazyLoad=function(m){function s(b,a){var g=m.createElement(b),c;for(c in a)a.hasOwnProperty(c)&&g.setAttribute(c,a[c]);return g}function n(b){var a=p[b],c,k;a&&(c=a.callback,k=a.urls,k.shift(),e=0,k.length||(c&&c.call(a.context,a.obj),p[b]=null,q[b].length&&l(b)))}function z(){var b=navigator.userAgent;c={async:!0===m.createElement("script").async};(c.webkit=/AppleWebKit\//.test(b))||(c.ie=/MSIE|Trident/.test(b))||(c.opera=/Opera/.test(b))||(c.gecko=/Gecko\//.test(b))||(c.unknown=!0)}function l(b,a,g,k,e){var l=function(){n(b)},r="css"===b,t=[],f,h,d,u;c||z();if(a)if(a="string"===typeof a?[a]:a.concat(),r||c.async||c.gecko||c.opera)q[b].push({urls:a,callback:g,obj:k,context:e});else for(f=0,h=a.length;f<h;++f)q[b].push({urls:[a[f]],callback:f===h-1?g:null,obj:k,context:e});if(!p[b]&&(u=p[b]=q[b].shift())){v||(v=m.head||m.getElementsByTagName("head")[0]);a=u.urls.concat();f=0;for(h=a.length;f<h;++f)g=a[f],r?d=c.gecko?s("style"):s("link",{href:g,rel:"stylesheet"}):(d=s("script",{src:g}),d.async=!1),d.className="lazyload",d.setAttribute("charset","utf-8"),c.ie&&!r&&"onreadystatechange"in d&&!("draggable"in d)?d.onreadystatechange=function(){/loaded|complete/.test(d.readyState)&&(d.onreadystatechange=null,l())}:r&&(c.gecko||c.webkit)?c.webkit?(u.urls[f]=d.href,w()):(d.innerHTML='@import "'+g+'";',x(d)):d.onload=d.onerror=l,t.push(d);f=0;for(h=t.length;f<h;++f)v.appendChild(t[f])}}function x(b){var a;try{a=!!b.sheet.cssRules}catch(c){e+=1;200>e?setTimeout(function(){x(b)},50):a&&n("css");return}n("css")}function w(){var b=p.css,a;if(b){for(a=y.length;0<=--a;)if(y[a].href===b.urls[0]){n("css");break}e+=1;b&&(200>e?setTimeout(w,50):n("css"))}}var c,v,p={},e=0,q={css:[],js:[]},y=m.styleSheets;return{css:function(b,a,c,e){l("css",b,a,c,e)},js:function(b,a,c,e){l("js",b,a,c,e)}}}(this.document);
/*! Media Manager v1.0.0 | Author: Tomas NorkÅ«nas */
(function(q,m,d,s,z){function t(a){this.num=E++;this.id="media-manager-"+this.num;this.options=d.extend(!0,{url:"/media-manager",locale:"en",multiple:!1,onInsert:null},a||{});this.templates={};this.search=this.order=this.sortby=this.filter="";this.dropzone={loaded:!1,uploaded:!1};this.bsStack=0;F(this,function(a,c){a.assets=c.assets;a.path=c.path;a.smark=a.explorer.find("#sort-mark");a.omark=a.explorer.find("#order-mark");A(a)})}function A(a){a.explorer.modal({show:!1,backdrop:"static"}).find("[data-toggle=tooltip]").tooltip({container:"#"+a.id+" .modal-body"});z.css(["mediamanager","scrollbar","contextmenu","colorbox","dropzone"].map(function(b){return a.assets+"/css/"+b+".css"}));z.js(["mousewheel","scrollbar","contextmenu","colorbox","dropzone"].map(function(b){return a.assets+"/js/"+b+".js"}),function(){Dropzone.autoDiscover=!1;Dropzone.confirm=function(b,c,d){u(a,b,function(a){a?c():"function"===typeof d&&d()})};a.explorer.find(".grid-wrapper").css("overflow","hidden").mCustomScrollbar({theme:"dark",scrollInertia:100,advanced:{updateOnContentResize:!0}});G(a)});a.binds=new k(a);a.commands=new p(a)}function e(a,b){var c=setInterval(function(){a.explorer&&("function"===typeof b&&b(a),clearInterval(c))},10)}function k(a){for(var b in this)if("function"===typeof this[b])this[b](a)}function p(a){for(var b in this)if("function"===typeof this[b])this[b](a)}function l(a,b,c,f,v){return d.post(a.options.url,d.extend({cmd:b},c),d.noop,"json").done(function(b,c,d){1!==b.status&&0!==b.status?n(a,"Unexpected error occured."):f(b,c,d)}).fail(function(b,c,d){if("function"===typeof v&&!1===v(b,c,d))return!1;n(a,"Unexpected error occured with message: <b>"+d+"</b>.")})}function F(a,b){return l(a,"initManager",{insert:"function"===typeof a.options.onInsert,locale:a.options.locale},function(c){if(1===c.status){d.each(c.templates,function(b,c){a.templates[b]=s.template(c)});var f=d("#"+a.id);a.explorer=f.length?f:d(a.templates.explorer()).attr("id",a.id).appendTo("body");"function"===typeof b&&b(a,c)}})}function r(a,b){return l(a,"getFiles",b||{},function(b){1===b.status&&(H(a,b.breadcrumb),a.explorer.find(".grid").html(a.templates.files(b)))})}function H(a,b){var c=a.explorer.find(".breadcrumb").empty();c.append('<li><a href="javascript:void(0);" data-path=""><i class="glyphicon glyphicon-home"></i></a></li>');1>b.length&&c.append("<li></li>");var f="";d.each(b,function(a,b){f=""!==f?f+"/"+b:b;c.append('<li><a href="javascript:void(0);" data-path="'+f+'">'+b+"</a></li>")})}function h(a,b){a.explorer.find(".grid").empty();a.search="";a.explorer.find(".search-query").val("");r(a,{path:b,filter:a.filter,sort:a.sortby,order:a.order})}function w(a,b,c){return r(a,{path:a.path,filter:a.filter,sort:b||"title",order:c||"asc"})}function x(a,b){b=b.trim()||"";return r(a,{path:a.path,filter:a.filter,sort:a.sortby,order:a.order,search:b})}function n(a,b){var c=d(a.templates.alert()).modal({show:!1,backdrop:"static"}).on("hidden.bs.modal",function(){c.remove()}).find(".modal-body").html(b).end().appendTo("body").modal("show")}function u(a,b,c){c="function"===typeof c?c:function(){};var f=d(a.templates.confirm()).modal({show:!1,backdrop:"static"}).on("hidden.bs.modal",function(){f.remove()}).find("[data-dismiss=modal]").one("click",function(){f.modal("hide");c(!1);return!1}).end().find(".btn-confirm").one("click",function(){f.modal("hide");c(!0);return!1}).end().find(".modal-body").html(b).end().appendTo("body").modal("show");return!0}function I(a){var b=d(a.templates.create_folder()).modal({show:!1,backdrop:"static"}).on("hidden.bs.modal",function(){b.remove()}).find(".btn-create-folder").one("click",function(){var c=d(this).parent().prev().find("input[type=text]").val();return l(a,"createFolder",{path:a.path,file:c},function(c){b.modal("hide");if(1===c.status||0===c.status)c.message&&n(a,c.message),1===c.status&&h(a,a.path)},function(){b.modal("hide")})}).end().appendTo("body").modal("show");return!0}function B(a,b){var c=d(a.templates.edit_text()).modal({show:!1,backdrop:"static"}).on("hidden.bs.modal",function(){c.remove()}).find(".btn-update").one("click",function(){var f=d(this).parent().prev().find("textarea").val();return l(a,"updateContents",{path:a.path,file:b,content:f},function(b){c.modal("hide");1!==b.status&&0!==b.status||n(a,b.message)},function(){c.modal("hide")})}).end().find("textarea").val(function(c,v){var g=d(this);return l(a,"getContents",{path:a.path,file:b},function(b){1===b.status?g.val(b.message):0===b.status&&n(a,b.message)})}).end().appendTo("body").modal("show");return!0}function C(a,b){var c=d(a.templates.rename()).modal({show:!1,backdrop:"static"}).on("hidden.bs.modal",function(){c.remove()}).find(".btn-rename").one("click",function(){var f=d(this).parent().prev().find("input[type=text]").val();return l(a,"renameFile",{path:a.path,file:b,target:f},function(b){c.modal("hide");if(1===b.status||0===b.status)b.message&&n(a,b.message),1===b.status&&h(a,a.path)},function(){c.modal("hide")})}).end().find("input[type=text]").val(b).end().appendTo("body").modal("show");return!0}function D(a,b){u(a,"Are you sure want to delete this file?",function(c){if(c)return l(a,"deleteFile",{path:a.path,file:b},function(b){if(1===b.status||0===b.status)n(a,b.message),h(a,a.path)})})}function y(a){if("undefined"!==typeof d.colorbox)switch(a.dataset.type){case "image":d.colorbox({maxHeight:"98%",href:a.dataset.url});return;case "video":d.colorbox({maxHeight:"98%",html:'<div style="padding:20px"><video src="'+a.dataset.url+'" controls autoplay preload="auto">Your browser does not support the <code>video</code> element.</video></div>'});return;case "audio":d.colorbox({maxHeight:"98%",html:'<div style="padding:20px"><audio src="'+a.dataset.url+'" controls autoplay preload="auto">Your browser does not support the <code>audio</code> element.</audio></div>'});return}q.open(a.dataset.url,"_blank").focus()}function J(a,b){if(!a.dropzone.loaded){a.uploader=d(a.templates.upload()).attr("id","media-manager-uploader-"+a.num).appendTo("body");var c=new Dropzone(a.uploader.find("form").get(0),{url:a.options.url,addRemoveLinks:!0,accept:function(b,c){return l(a,"getFileInfo",{path:a.path,file:b.name},function(b){1===b.status&&(b.exists?u(a,"Are you sure want to overwrite this file?",function(a){a?c():c("Cancelled")}):c())})},sending:function(b,c,d){d.append("cmd","uploadFile");d.append("path",a.path)},success:function(b,c){if(1===c.status)return a.dropzone.uploaded=!0,b.previewElement.classList.add("dz-success");if(0===c.status){var d,e,l,h,k;b.previewElement.classList.add("dz-error");h=b.previewElement.querySelectorAll("[data-dz-errormessage]");k=[];e=0;for(l=h.length;e<l;e++)d=h[e],k.push(d.textContent=c.message);return k}}});a.uploader.modal({show:!1,backdrop:"static"}).on("hidden.bs.modal",function(){a.dropzone.uploaded&&(h(a,a.path),a.dropzone.uploaded=!1,c.removeAllFiles())});a.dropzone.loaded=!0}b(a.uploader)}function G(a){d.contextMenu({selector:"#"+a.explorer.attr("id")+" .grid > li",build:function(b,c){var d=b.get(0).dataset,e={edit:{name:a.explorer.find("[data-command=edit]").text(),callback:function(b,c){"text"===d.type&&B(a,d.name)}},"delete":{name:a.explorer.find("[data-command=delete]").text(),callback:function(b,c){D(a,d.name)}},rename:{name:a.explorer.find("[data-command=rename]").text(),callback:function(b,c){C(a,d.name)}},preview:{name:a.explorer.find("[data-command=preview]").text(),callback:function(a,c){y(b.get(0))}}},g={};switch(d.type){case "directory":g=e;delete g.edit;break;case "image":g=e;delete g.edit;break;case "video":g=e;delete g.edit;break;case "audio":g=e;delete g.edit;break;case "text":g=e;break;case "application":g=e;delete g.edit;break;case "inode":g=e,delete g.edit}return{items:g}}})}var E=1;t.prototype={open:function(a){e(this,function(b){"function"===typeof a&&(b.options.onInsert=a);r(b);b.explorer.modal("show")});return this},close:function(){e(this,function(a){a.explorer.modal("hide");a.explorer.find(".grid > li.selected").removeClass("selected")});return this},path:function(a){this.path=a||"";e(this,function(b){a(b,b.path)});return this},refresh:function(){e(this,function(a){h(a,a.path)});return this},filter:function(a){this.filter=a||"";e(this,function(b){a(b,b.filter)});return this},sort:function(a,b){this.sortby=a||"title";this.order=b||"asc";e(this,function(a){w(a,a.sortby,a.order)});return this},search:function(a){this.search=a||"";e(this,function(a){x(a,a.search)});return this}};k.prototype={modalStack:function(a){d(m).on("show.bs.modal",function(){a.bsStack++});d(m).on("hide.bs.modal",function(){a.bsStack--});d(m).on("hidden.bs.modal",function(){0<a.bsStack&&d("body").addClass("modal-open")})},upload:function(a){a.explorer.on("click","[data-action=upload]",function(){J(a,function(a){a.modal("show")})})},folder:function(a){a.explorer.on("click","[data-action=create-folder]",function(){I(a)})},refresh:function(a){a.explorer.on("click","[data-action=refresh]",function(){h(a,a.path)})},filter:function(a){a.explorer.on("click","[data-filter]",function(){a.filter=this.dataset.filter;var b=a.filter;a.explorer.find("[data-filter].btn-primary").removeClass("btn-primary").addClass("btn-default");a.explorer.find("[data-filter="+b+"]").removeClass("btn-default").addClass("btn-primary");r(a,{path:a.path,filter:b,sort:a.sortby,order:a.order})})},sort:function(a){a.explorer.on("click","[data-sortby]",function(){a.sortby=this.dataset.sortby;a.smark.appendTo(d(this).find("a"));w(a,a.sortby)});a.explorer.on("click","[data-order]",function(){a.order=this.dataset.order;a.omark.appendTo(d(this).find("a"));w(a,a.sortby,a.order)})},search:function(a){a.explorer.on("click","[data-action=search]",function(){x(a,this.parentNode.previousElementSibling.value)});a.explorer.find(".search-query").keypress(function(b){if(13===b.which)return a.search=this.value,x(a,this.value),this.blur(),!1})},breadcrumb:function(a){a.explorer.find(".breadcrumb").on("click","[data-path]",function(){a.path=this.dataset.path;h(a,this.dataset.path)})},select:function(a){a.explorer.on("click",".grid > li",function(){var b=d(this),c=d(".command-menu",a.explorer),e=d("[data-action=insert]",a.explorer);d(".grid > li.selected",a.explorer);a.options.multiple||b.siblings(".selected").removeClass("selected");b.toggleClass("selected");0<d(".grid > li.selected",a.explorer).length?(c.removeClass("hide"),e.removeAttr("disabled")):(c.addClass("hide"),e.attr("disabled","disabled"))}).on("dblclick",".grid > li",function(){"directory"===this.dataset.type?(a.path=this.dataset.path,h(a,this.dataset.path)):y(this)}).on("contextmenu",".grid > li",function(){var b=d(this);d(".grid > li.selected",a.explorer);b.siblings(".selected").removeClass("selected").end().addClass("selected")})},insert:function(a){a.explorer.on("click","[data-action=insert]",function(){var b=d(".grid > li.selected",a.explorer);if(b.length){if(a.options.multiple){var c=[];b.each(function(){c.push(this.dataset.url)});a.options.onInsert(c)}else a.options.onInsert(b.first().data("url"));a.close()}})}};p.prototype={edit:function(a){a.explorer.on("click","[data-command=edit]",function(){var b=d(".grid > li.selected:first",a.explorer).get(0);switch(b.dataset.type){case "text":B(a,b.dataset.name)}})},"delete":function(a){a.explorer.on("click","[data-command=delete]",function(){var b=d(".grid > li.selected:first",a.explorer).get(0);D(a,"directory"===b.dataset.type?b.dataset.path:b.dataset.file)})},rename:function(a){a.explorer.on("click","[data-command=rename]",function(){var b=d(".grid > li.selected:first",a.explorer).get(0);C(a,b.dataset.name)})},preview:function(a){a.explorer.on("click","[data-command=preview]",function(){var b=d(".grid > li.selected:first",a.explorer).get(0);y(b)})}};q.MediaManager=t})(window,document,$,doT,LazyLoad);(function(q){if("undefined"!==typeof tinymce){var m=[];tinymce.PluginManager.add("mediamanager",function(d){if(0>m.indexOf(d.id)){m.push(d.id);var s=new MediaManager({locale:"undefined"!==typeof d.settings.language?d.settings.language:"en",onInsert:function(){}});d.settings.file_browser_callback=function(m,t,A,e){s.open(function(k){var p=e.document.getElementById(m);p.value=d.convertURL(k,null,null);"createEvent"in q?(k=q.createEvent("HTMLEvents"),k.initEvent("change",!1,!0),p.dispatchEvent(k)):p.fireEvent("onchange")})}}})}})(document);